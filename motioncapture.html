<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Drum Kit</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <script>
        let drumSounds = {};
        let video;
        let motionCanvas;
        let previousFrame = null;

        function preload() {
            // Load drum sounds
            drumSounds.kick = loadSound('kick.wav');
            drumSounds.snare = loadSound('snare.wav');
            drumSounds.hihat = loadSound('hihat.wav');
        }

        function setup() {
            createCanvas(640, 480);
            video = createCapture(VIDEO);
            video.size(width, height);
            video.hide();
            motionCanvas = createCapture(VIDEO);
            motionCanvas.size(width, height);
            motionCanvas.hide();
        }

        function draw() {
            // Capture the current frame from the webcam
            let currentFrame = get();
            image(video, 0, 0, width, height);

            // Convert the frame to grayscale for motion detection
            currentFrame.filter(GRAY);

            // If it's the first frame, store it and continue
            if (previousFrame === null) {
                previousFrame = currentFrame;
                return;
            }

            // Calculate the absolute difference between the current frame and the previous frame
            let diff = abs(previousFrame.get() - currentFrame.get());
            diff.filter(THRESHOLD);

            // Calculate the sum of pixel values in the difference image
            diff.loadPixels();
            let sum = 0;
            for (let i = 0; i < diff.pixels.length; i += 4) {
                sum += diff.pixels[i];
            }

            // Play drum sounds based on the detected motion
            if (sum > 5000) {
                let x = mouseX;
                let y = mouseY;

                // Determine which drum sound to play based on mouse position
                if (x < width / 3) {
                    drumSounds.kick.play();
                } else if (x >= width / 3 && x < (2 * width) / 3) {
                    drumSounds.snare.play();
                } else {
                    drumSounds.hihat.play();
                }
            }

            // Store the current frame for comparison in the next iteration
            previousFrame = currentFrame;
        }
    </script>
</body>
</html>
